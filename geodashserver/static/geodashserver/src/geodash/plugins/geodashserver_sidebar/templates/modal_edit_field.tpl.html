<div
  id="geodash-modal-edit-field"
  class="geodash-controller geodash-controller-modal geodash-modal modal fade geodash-edit-field"
  tabindex="-1"
  role="dialog"
  aria-labelledby="myModalLabel">
  <div id="geodash-edit-field" class="modal-dialog geodash-responsive" role="document">
    <div
      ng-if="field_flat | default_if_undefined: false"
      class="modal-content">
      <div class="modal-header">
        <button geodash-btn-close></button>
        <h4
          id="myModalLabel"
          class="modal-title"
          ng-bind-html="modaleditfield_schema | extract : field : 'label' | prepend : 'Edit / ' | md2html"></h4>
      </div>
      <div class="modal-body">
        <ul class="nav nav-tabs nav-justified" role="tablist">
          <li label="Input" target="modal-edit-field-pane-input" active="true" geodash-tab></li>
          <li label="YAML" target="modal-edit-field-pane-yaml" geodash-tab></li>
          <li label="JSON" target="modal-edit-field-pane-json" geodash-tab></li>
        </ul>
        <div class="tab-content">
          <div
            id="modal-edit-field-pane-input"
            role="tabpanel"
            class="tab-pane fade"
            style="padding: 10px;">
            <div
              ng-if="modaleditfield_schema | extract : field : 'type' | inArray: ['text', 'string', 'markdown', 'md']">
              <textarea
                id="modal-edit-field-{{ field_flat }}"
                name="modal-edit-field-{{ field_flat }}"
                class="form-control"
                placeholder="{{ modaleditfield_schema | extract : field : 'placeholder' }}"
                rows="15"
                data-geodash-field-type="{{ modaleditfield_schema | extract : field : 'type' }}"
                ng-required="modaleditfield_schema | extract : field : 'required'"
                style="max-width: 100%;"
                ng-model="value_edit_field"
                ng-change="validateModalField(field_flat)"></textarea>
            </div>
            <div
              ng-if="modaleditfield_schema | extract : field : 'type' | inArray: ['textarray', 'stringarray']">
              <div class="input-group">
                <input
                  id="editor-field-{{ field_flat }}-backend"
                  name="editor-field-{{ field_flat }}-backend"
                  type="text"
                  class="form-control"
                  style="display:none;">
                <div
                  class="input-group-addon btn btn-primary"
                  data-toggle="tooltip"
                  data-placement="bottom"
                  ng-attr-title="{{ modaleditfield_schema | extract : field : 'description' }}">
                  <i class="fa fa-info-circle"></i>
                </div>
                <div
                  id="editor-field-{{ field_flat }}-label"
                  name="editor-field-{{ field_flat }}-label"
                  class="input-group-addon"
                  ng-bind-html="modaleditfield_schema | extract : field : 'label'">
                </div>
                <input
                  id="editor-field-{{ field_flat }}"
                  name="editor-field-{{ field_flat }}"
                  type="text"
                  class="typeahead form-control"
                  style="height: auto;"
                  data-geodash-field-type="{{ modaleditfield_schema | extract : field : 'type' }}"
                  ng-required="modaleditfield_schema | extract : field : 'required'"
                  aria-describedby="editor-field-{{ field_flat }}-label"
                  data-initial-data="{{ modaleditfield_schema | extract : field : 'source' }}"
                  data-backend="editor-field-{{ field_flat }}-backend"
                  data-template-empty="<div class=&quot;alert alert-danger empty-message&quot;>Unable to find value</div>"
                  ng-keyup="keyUpOnField($event, field, field_flat)">
                <div
                  class="input-group-addon btn btn-primary btn-show-options"
                  data-toggle="tooltip"
                  data-placement="bottom"
                  title="Show Options."
                  ng-click="showOptions($event, '#editor-field-'+field_flat)">
                  <i class="fa fa-chevron-down"></i>
                </div>
                <div
                  class="input-group-addon btn btn-success btn-add"
                  data-toggle="tooltip"
                  data-placement="bottom"
                  title="Prepend to list of layers."
                  ng-click="prependToField($event, field, field_flat)">
                  <i class="fa fa-plus"></i>
                </div>
                <div
                  class="input-group-addon btn btn-danger btn-clear"
                  data-target="#editor-field-{{ field_flat }}"
                  data-toggle="tooltip"
                  data-placement="bottom"
                  title="Clear new layer text.">
                  <i class="fa fa-times"></i>
                </div>
              </div>
              <br>
              <div
                ng-repeat="x in modaleditfield_workspace | extract : field track by $index"
                class="input-group"
                style="margin-bottom: 4px;">
                <div
                  class="input-group-addon btn btn-default"
                  style="font-weight: bold;"
                  ng-bind-html="$index">
                </div>
                <div
                  ng-class="$first ? 'input-group-addon btn btn-default' : 'input-group-addon btn btn-primary'"
                  ng-disabled="$first"
                  ng-click="up($event, field, field_flat, $index)">
                  <i class="fa fa-arrow-up"></i>
                </div>
                <div
                  ng-class="$last ? 'input-group-addon btn btn-default' : 'input-group-addon btn btn-primary'"
                  ng-disabled="$last"
                  ng-click="down($event, field, field_flat, $index)">
                  <i class="fa fa-arrow-down"></i>
                </div>
                <input
                  id="editor-field-{{ field_flat }}-{{ $index }}"
                  name="editor-field-{{ field_flat }}-{{ $index }}"
                  type="text"
                  class="form-control"
                  ng-value="x">
                <div
                  class="input-group-addon btn btn-danger btn-clear"
                  ng-click="subtractFromField($event, field, field_flat, $index)">
                  <i class="fa fa-times"></i>
                </div>
              </div>
            </div>
            <div
              ng-if="modaleditfield_schema | extract : field : 'type' | inArray: ['objectarray', 'objarray']">
              <div>
                <div
                  class="btn btn-primary"
                  data-toggle="tooltip"
                  data-placement="bottom"
                  ng-attr-title="{{ modaleditfield_schema | extract : field : 'description' }}">
                  <i class="fa fa-info-circle"></i>
                </div>
                <div
                  class="btn btn-success btn-add geodash-intent"
                  data-toggle="tooltip"
                  data-placement="bottom"
                  title="Prepend to list."
                  data-intent-name="switchModal"
                  data-intent-data="{{ html5data('switchModal', config.that.id , config.edit.target, field, undefined) }}"
                  data-intent-ctrl="{{ config.that.id }}">
                  <i class="fa fa-plus"></i>
                </div>
              </div>
              <br>
              <div
                ng-repeat="x in modaleditfield_workspace | extract : field track by $index"
                class="input-group"
                style="margin-bottom: 4px;">
                <div
                  class="input-group-addon btn btn-default"
                  style="font-weight: bold;"
                  ng-bind-html="$index">
                </div>
                <div
                  ng-class="$first ? 'input-group-addon btn btn-default' : 'input-group-addon btn btn-primary'"
                  ng-disabled="$first"
                  ng-click="up($event, field, field_flat, $index)">
                  <i class="fa fa-arrow-up"></i>
                </div>
                <div
                  ng-class="$last ? 'input-group-addon btn btn-default' : 'input-group-addon btn btn-primary'"
                  ng-disabled="$last"
                  ng-click="down($event, field, field_flat, $index)">
                  <i class="fa fa-arrow-down"></i>
                </div>
                <span
                  id="editor-field-{{ field_flat }}-{{ $index }}"
                  name="editor-field-{{ field_flat }}-{{ $index }}"
                  type="text"
                  class="form-control"
                  ng-bind-html="x.title + ' ('+x.id+')'"></span>
                <a
                  class="geodash-intent input-group-addon btn btn-primary btn-edit"
                  href="#"
                  data-intent-name="switchModal"
                  data-intent-data="{{ html5data('switchModal', config.that.id, config.edit.target, field, $index) }}"
                  data-intent-ctrl="{{ config.that.id }}">
                  <i class="fa fa-pencil-square-o "></i>
                </a>
                <div
                  class="input-group-addon btn btn-danger btn-clear"
                  ng-click="subtractFromField($event, field, field_flat, $index)">
                  <i class="fa fa-times"></i>
                </div>
              </div>
            </div>
          </div>
          <div
            id="modal-edit-field-pane-yaml"
            class="tab-pane fade"
            role="tabpanel"
            style="padding: 10px;">
            <pre style="word-wrap: break-word; white-space: pre-wrap;">{{ value_edit_field | yaml : 8 }}</pre>
          </div>
          <div
            id="modal-edit-field-pane-json"
            class="tab-pane fade"
            role="tabpanel"
            style="padding: 10px;">
            <pre style="word-wrap: break-word; white-space: pre-wrap;">{{ value_edit_field | json }}</pre>
          </div>
        </div>
        <hr>
        <div
          class="btn btn-danger btn-clear"
          data-target="#modal-edit-field-{{ field_flat }}, #editor-field-{{ field_flat }}">
          <i class="fa fa-times"></i>
        </div>
      </div>
      <div class="modal-footer">
        <button
          type="button"
          class="btn btn-success geodash-intent"
          data-intent-name="saveAndHide"
          data-intent-data="{{ html5data('saveAndHide', config.that.id, config.save.target, config.save.fields) }}"
          data-intent-ctrl="{{ config.that.id }}"
          ng-bind-html="modaleditfield_schema | extract : field : 'label' | prepend : 'Save ' | md2html"
        ></button>
        <button
          type="button"
          class="btn btn-default geodash-intent"
          data-intent-name="hideModal"
          data-intent-data="{{ html5data('hideModal', config.that.id) }}"
          data-intent-ctrl="{{ config.that.id }}"
          ng-bind-html="'Cancel'"></button>
      </div>
    </div>
  </div>
</div>
